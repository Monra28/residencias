@(platillos: List[models.Platillo], categorias: List[models.Categoria])
<!DOCTYPE html>
<html>
<head>
    <title>Gesti√≥n de Platillos</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="bg-light">
    <div class="container mt-5">
        <div class="row justify-content-center">
            <div class="col-md-8">
                <div class="card">
                    <div class="card-header bg-primary text-white text-center">
                        <h2>üçΩÔ∏è Gesti√≥n de Platillos</h2>
                        <p>Sistema de administraci√≥n de men√∫ del restaurante</p>
                    </div>
                    <div class="card-body">
                        <form id="platilloForm" method="POST" action="/platillos">
                            <input type="hidden" id="editId" name="editId">
                            <input type="hidden" id="editMode" name="editMode" value="false">
                            <div class="row">
                                <div class="col-md-6 mb-3">
                                    <label for="nombre" class="form-label">Nombre del Platillo</label>
                                    <input type="text" class="form-control" id="nombre" name="nombre" required>
                                </div>
                                <div class="col-md-6 mb-3">
                                    <label for="categoria" class="form-label">Categor√≠a</label>
                                    <select class="form-control" id="categoria" name="categoria" required>
                                        <option value="">Seleccione una categor√≠a</option>
                                        @if(categorias != null) {
                                            @for(categoria <- categorias) {
                                                <option value="@categoria.getNombre()">@categoria.getNombre()</option>
                                            }
                                        }
                                    </select>
                                </div>
                            </div>
                            
                            <div class="mb-3">
                                <label for="descripcion" class="form-label">Descripci√≥n</label>
                                <textarea class="form-control" id="descripcion" name="descripcion" rows="3"></textarea>
                            </div>
                            
                            <div class="row">
                                <div class="col-md-6 mb-3">
                                    <label for="precio" class="form-label">Precio</label>
                                    <div class="input-group">
                                        <span class="input-group-text">$</span>
                                        <input type="number" class="form-control" id="precio" name="precio" step="0.01" min="0.01" required>
                                    </div>
                                </div>
                                <div class="col-md-6 mb-3">
                                    <label for="imagenUrl" class="form-label">URL de la Imagen</label>
                                    <input type="url" class="form-control" id="imagenUrl" name="imagenUrl">
                                </div>
                            </div>
                            
                            <div class="mb-3">
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" id="disponible" name="disponible" checked>
                                    <label class="form-check-label" for="disponible">Disponible en el men√∫</label>
                                </div>
                            </div>
                            
                            <div class="d-flex justify-content-end">
                                <button type="button" class="btn btn-secondary me-2" onclick="limpiarFormulario()">Limpiar</button>
                                <button type="button" class="btn btn-warning me-2" id="cancelarEdicion" onclick="cancelarEdicion()" style="display: none;">Cancelar</button>
                                <button type="submit" class="btn btn-success" id="btnGuardar">Guardar Platillo</button>
                            </div>
                        </form>
                        
                        <hr class="my-4">
                        
                        <div class="text-center">
                            <h4>üç¥ Platillos Registrados en la Base de Datos</h4>
                            <div id="listaPlatillos">
                                @if(platillos != null && !platillos.isEmpty()) {
                                    @for(platillo <- platillos) {
                                        <div class="card mb-3">
                                            <div class="card-body">
                                                <div class="row align-items-center">
                                                    <div class="col-md-8">
                                                        <h5 class="card-title">@platillo.getNombre()</h5>
                                                        <p class="card-text text-muted">
                                                            <span class="badge bg-primary">@platillo.getCategoria()</span>
                                                        </p>
                                                        <p class="card-text">@platillo.getDescripcion()</p>
                                                        @if(platillo.getImagenUrl() != null && !platillo.getImagenUrl().isEmpty()) {
                                                            <small class="text-muted">Imagen: @platillo.getImagenUrl()</small>
                                                        }
                                                    </div>
                                                    <div class="col-md-4 text-end">
                                                        <span class="badge bg-success fs-6">$$@platillo.getPrecio()</span>
                                                        @if(platillo.getDisponible()) {
                                                            <span class="badge bg-success ms-1">Disponible</span>
                                                        } else {
                                                            <span class="badge bg-danger ms-1">No disponible</span>
                                                        }
                                                        <div class="mt-2">
                                                            <a href="/platillos/@platillo.getId()" class="btn btn-info btn-sm me-1">Ver</a>
                                                            <button class="btn btn-warning btn-sm me-1" onclick="editarPlatillo(@platillo.getId())">Editar</button>
                                                            <button class="btn btn-danger btn-sm" onclick="eliminarPlatillo(@platillo.getId())">Eliminar</button>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    }
                                } else {
                                    <div class="alert alert-info">
                                        <h5>üìù No hay platillos registrados en la base de datos</h5>
                                        <p>¬°Agrega el primer platillo usando el formulario de arriba!</p>
                                    </div>
                                }
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        function limpiarFormulario() {
            document.getElementById('platilloForm').reset();
            document.getElementById('editId').value = '';
            document.getElementById('editMode').value = 'false';
            document.getElementById('btnGuardar').textContent = 'Guardar Platillo';
            document.getElementById('cancelarEdicion').style.display = 'none';
            document.getElementById('platilloForm').action = '/platillos';
        }
        
        function cancelarEdicion() {
            limpiarFormulario();
        }
        
        function editarPlatillo(id) {
            // Buscar los datos del platillo en la p√°gina actual
            const platilloCards = document.querySelectorAll('.card');
            let platilloData = null;
            
            platilloCards.forEach(card => {
                const editButton = card.querySelector(`button[onclick="editarPlatillo(${id})"]`);
                if (editButton) {
                    // Extraer datos del platillo de la card
                    const nombre = card.querySelector('.card-title').textContent;
                    const categoria = card.querySelector('.badge.bg-primary').textContent;
                    const descripcion = card.querySelector('.card-text:not(.text-muted)').textContent;
                    const precioText = card.querySelector('.badge.bg-success').textContent;
                    const precio = precioText.replace('$', '');
                    const disponible = card.querySelector('.badge.bg-success.ms-1') !== null;
                    const imagenElement = card.querySelector('small.text-muted');
                    const imagen = imagenElement ? imagenElement.textContent.replace('Imagen: ', '') : '';
                    
                    platilloData = {
                        id: id,
                        nombre: nombre,
                        categoria: categoria,
                        descripcion: descripcion,
                        precio: precio,
                        imagen: imagen,
                        disponible: disponible
                    };
                }
            });
            
            if (platilloData) {
                // Cargar datos en el formulario
                document.getElementById('editId').value = platilloData.id;
                document.getElementById('editMode').value = 'true';
                document.getElementById('nombre').value = platilloData.nombre;
                document.getElementById('categoria').value = platilloData.categoria;
                document.getElementById('descripcion').value = platilloData.descripcion;
                document.getElementById('precio').value = platilloData.precio;
                document.getElementById('imagenUrl').value = platilloData.imagen;
                document.getElementById('disponible').checked = platilloData.disponible;
                
                // Cambiar el comportamiento del formulario
                document.getElementById('btnGuardar').textContent = 'Actualizar Platillo';
                document.getElementById('cancelarEdicion').style.display = 'inline-block';
                document.getElementById('platilloForm').action = '/platillos/' + id;
                
                // Scroll hacia el formulario
                document.getElementById('platilloForm').scrollIntoView({ behavior: 'smooth' });
            } else {
                alert('Error al cargar datos del platillo');
            }
        }
        
        function eliminarPlatillo(id) {
            if (confirm('¬øSeguro que quieres eliminar este platillo?')) {
                // Usar fetch para enviar petici√≥n DELETE
                fetch('/platillos/' + id, {
                    method: 'DELETE',
                    headers: {
                        'Content-Type': 'application/json',
                    }
                })
                .then(response => {
                    if (response.ok) {
                        alert('Platillo eliminado correctamente');
                        location.reload(); // Recargar la p√°gina
                    } else {
                        alert('Error al eliminar el platillo');
                    }
                })
                .catch(error => {
                    console.error('Error:', error);
                    alert('Error al eliminar el platillo');
                });
            }
        }
        
        // Manejar el env√≠o del formulario para edici√≥n
        document.getElementById('platilloForm').addEventListener('submit', function(e) {
            const editMode = document.getElementById('editMode').value;
            const editId = document.getElementById('editId').value;
            
            if (editMode === 'true' && editId) {
                e.preventDefault();
                
                // Recopilar datos del formulario
                const formData = new FormData(this);
                const data = {};
                formData.forEach((value, key) => {
                    if (key !== 'editId' && key !== 'editMode') {
                        data[key] = value;
                    }
                });
                
                // Enviar petici√≥n PUT para actualizar
                fetch('/platillos/' + editId, {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/x-www-form-urlencoded',
                    },
                    body: new URLSearchParams(data)
                })
                .then(response => {
                    if (response.ok) {
                        alert('Platillo actualizado correctamente');
                        location.reload();
                    } else {
                        alert('Error al actualizar el platillo');
                    }
                })
                .catch(error => {
                    console.error('Error:', error);
                    alert('Error al actualizar el platillo');
                });
            }
        });
    </script>
</body>
</html>
