@()
<!DOCTYPE html>
<html>
<head>
    <title>Gestión de Usuarios</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
</head>
<body class="bg-light">
    <div class="container mt-5">
        <div class="row justify-content-center">
            <div class="col-md-10">
                <div class="card shadow">
                    <div class="card-header bg-success text-white text-center">
                        <h2><i class="fas fa-users me-2"></i>Gestión de Usuarios</h2>
                        <p>Sistema de administración de usuarios del restaurante</p>
                    </div>
                    <div class="card-body">
                        <form id="usuarioForm">
                            <input type="hidden" id="editIndex">
                            <div class="row">
                                <div class="col-md-6 mb-3">
                                    <label for="nombre" class="form-label">
                                        <i class="fas fa-user me-1"></i>Nombre Completo
                                    </label>
                                    <input type="text" class="form-control" id="nombre" name="nombre" required>
                                </div>
                                <div class="col-md-6 mb-3">
                                    <label for="email" class="form-label">
                                        <i class="fas fa-envelope me-1"></i>Correo Electrónico
                                    </label>
                                    <input type="email" class="form-control" id="email" name="email" required>
                                </div>
                            </div>
                            
                            <div class="row">
                                <div class="col-md-6 mb-3">
                                    <label for="password" class="form-label">
                                        <i class="fas fa-lock me-1"></i>Contraseña
                                    </label>
                                    <input type="password" class="form-control" id="password" name="password" required>
                                </div>
                                <div class="col-md-6 mb-3">
                                    <label for="confirmPassword" class="form-label">
                                        <i class="fas fa-lock me-1"></i>Confirmar Contraseña
                                    </label>
                                    <input type="password" class="form-control" id="confirmPassword" name="confirmPassword" required>
                                </div>
                            </div>
                            
                            <div class="row">
                                <div class="col-md-4 mb-3">
                                    <label for="rol" class="form-label">
                                        <i class="fas fa-user-tag me-1"></i>Rol
                                    </label>
                                    <select class="form-control" id="rol" name="rol" required>
                                        <option value="">Seleccione un rol</option>
                                        <option value="ADMINISTRADOR">Administrador</option>
                                        <option value="GERENTE">Gerente</option>
                                        <option value="MESERO">Mesero</option>
                                        <option value="COCINERO">Cocinero</option>
                                        <option value="USUARIO">Usuario</option>
                                    </select>
                                </div>
                                <div class="col-md-4 mb-3">
                                    <label for="telefono" class="form-label">
                                        <i class="fas fa-phone me-1"></i>Teléfono
                                    </label>
                                    <input type="tel" class="form-control" id="telefono" name="telefono">
                                </div>
                                <div class="col-md-4 mb-3">
                                    <label for="activo" class="form-label">
                                        <i class="fas fa-toggle-on me-1"></i>Estado
                                    </label>
                                    <div class="form-check form-switch mt-2">
                                        <input class="form-check-input" type="checkbox" id="activo" name="activo" checked>
                                        <label class="form-check-label" for="activo">Usuario Activo</label>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="mb-3">
                                <label for="direccion" class="form-label">
                                    <i class="fas fa-map-marker-alt me-1"></i>Dirección
                                </label>
                                <textarea class="form-control" id="direccion" name="direccion" rows="2"></textarea>
                            </div>
                            
                            <div class="d-flex justify-content-end">
                                <button type="button" class="btn btn-secondary me-2" onclick="limpiarFormulario()">
                                    <i class="fas fa-eraser me-1"></i>Limpiar
                                </button>
                                <button type="submit" class="btn btn-success">
                                    <i class="fas fa-save me-1"></i>Guardar Usuario
                                </button>
                            </div>
                        </form>
                        
                        <hr class="my-4">
                        
                        <div class="text-center mb-3">
                            <h4><i class="fas fa-list me-2"></i>Usuarios Registrados</h4>
                            <div class="input-group justify-content-center" style="max-width: 400px;">
                                <input type="text" class="form-control" id="buscarUsuario" placeholder="Buscar usuario...">
                                <button class="btn btn-outline-primary" type="button" onclick="buscarUsuarios()">
                                    <i class="fas fa-search"></i>
                                </button>
                            </div>
                        </div>
                        
                        <div id="listaUsuarios">
                            <div class="alert alert-info text-center">
                                <i class="fas fa-info-circle me-2"></i>
                                No hay usuarios registrados aún. ¡Agrega el primero!
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        let usuarios = [];
        let usuariosFiltrados = [];

        document.getElementById('usuarioForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const password = document.getElementById('password').value;
            const confirmPassword = document.getElementById('confirmPassword').value;
            
            if (password !== confirmPassword) {
                alert('Las contraseñas no coinciden');
                return;
            }
            
            const index = document.getElementById('editIndex').value;
            const formData = new FormData(this);
            const usuario = {
                nombre: formData.get('nombre'),
                email: formData.get('email'),
                password: formData.get('password'),
                rol: formData.get('rol'),
                telefono: formData.get('telefono'),
                direccion: formData.get('direccion'),
                activo: formData.get('activo') === 'on'
            };
            
            if (index) {
                usuarios[index] = usuario;
                alert('¡Usuario actualizado exitosamente!');
            } else {
                usuarios.push(usuario);
                alert('¡Usuario guardado exitosamente!');
            }

            renderListaUsuarios();
            limpiarFormulario();
        });
        
        function limpiarFormulario() {
            document.getElementById('usuarioForm').reset();
            document.getElementById('editIndex').value = '';
        }
        
        function renderListaUsuarios() {
            const lista = document.getElementById('listaUsuarios');
            lista.innerHTML = '';
            
            const usuariosAMostrar = usuariosFiltrados.length > 0 ? usuariosFiltrados : usuarios;
            
            if (usuariosAMostrar.length === 0) {
                lista.innerHTML = `
                    <div class="alert alert-info text-center">
                        <i class="fas fa-info-circle me-2"></i>
                        No hay usuarios registrados aún. ¡Agrega el primero!
                    </div>`;
                return;
            }
            
            usuariosAMostrar.forEach((usuario, i) => {
                const originalIndex = usuarios.indexOf(usuario);
                const rolBadgeClass = getRolBadgeClass(usuario.rol);
                
                lista.innerHTML += `
                    <div class="card mb-3 shadow-sm">
                        <div class="card-body">
                            <div class="row align-items-center">
                                <div class="col-md-8">
                                    <div class="d-flex align-items-center mb-2">
                                        <h6 class="card-title mb-0 me-2">${usuario.nombre}</h6>
                                        <span class="badge ${rolBadgeClass}">${usuario.rol}</span>
                                        <span class="badge ${usuario.activo ? 'bg-success' : 'bg-danger'} ms-1">
                                            ${usuario.activo ? 'Activo' : 'Inactivo'}
                                        </span>
                                    </div>
                                    <p class="card-text text-muted mb-1">
                                        <i class="fas fa-envelope me-1"></i>${usuario.email}
                                    </p>
                                    ${usuario.telefono ? `<p class="card-text text-muted mb-1">
                                        <i class="fas fa-phone me-1"></i>${usuario.telefono}
                                    </p>` : ''}
                                    ${usuario.direccion ? `<p class="card-text text-muted mb-1">
                                        <i class="fas fa-map-marker-alt me-1"></i>${usuario.direccion}
                                    </p>` : ''}
                                </div>
                                <div class="col-md-4 text-end">
                                    <div class="btn-group" role="group">
                                        <button class="btn btn-warning btn-sm" onclick="editarUsuario(${originalIndex})" title="Editar">
                                            <i class="fas fa-edit"></i>
                                        </button>
                                        <button class="btn btn-info btn-sm" onclick="cambiarEstadoUsuario(${originalIndex})" title="Cambiar Estado">
                                            <i class="fas fa-toggle-on"></i>
                                        </button>
                                        <button class="btn btn-danger btn-sm" onclick="eliminarUsuario(${originalIndex})" title="Eliminar">
                                            <i class="fas fa-trash"></i>
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            });
        }

        function getRolBadgeClass(rol) {
            switch(rol) {
                case 'ADMINISTRADOR': return 'bg-danger';
                case 'GERENTE': return 'bg-warning';
                case 'MESERO': return 'bg-info';
                case 'COCINERO': return 'bg-primary';
                default: return 'bg-secondary';
            }
        }

        function eliminarUsuario(index) {
            if (confirm('¿Seguro que quieres eliminar este usuario?')) {
                usuarios.splice(index, 1);
                renderListaUsuarios();
            }
        }

        function editarUsuario(index) {
            const usuario = usuarios[index];
            document.getElementById('nombre').value = usuario.nombre;
            document.getElementById('email').value = usuario.email;
            document.getElementById('password').value = usuario.password;
            document.getElementById('confirmPassword').value = usuario.password;
            document.getElementById('rol').value = usuario.rol;
            document.getElementById('telefono').value = usuario.telefono || '';
            document.getElementById('direccion').value = usuario.direccion || '';
            document.getElementById('activo').checked = usuario.activo;
            document.getElementById('editIndex').value = index;
        }

        function cambiarEstadoUsuario(index) {
            usuarios[index].activo = !usuarios[index].activo;
            renderListaUsuarios();
        }

        function buscarUsuarios() {
            const busqueda = document.getElementById('buscarUsuario').value.toLowerCase();
            usuariosFiltrados = usuarios.filter(usuario => 
                usuario.nombre.toLowerCase().includes(busqueda) ||
                usuario.email.toLowerCase().includes(busqueda) ||
                usuario.rol.toLowerCase().includes(busqueda)
            );
            renderListaUsuarios();
        }

        // Búsqueda en tiempo real
        document.getElementById('buscarUsuario').addEventListener('input', buscarUsuarios);
    </script>
</body>
</html>
